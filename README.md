devops-netology
===============

# Домашнее задание к занятию "10.01. Зачем и что нужно мониторить" Соловьев Д.В.

## Обязательные задания

### Выбрать метрики для мониторинга на проект

> 1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

#### Оценка работоспособности ПО.

- Количество HTTP/S запросов
- Процент корректных ответов (код <400)
- Запросы к приложению на типичные операции, которые в ответ должны дать ожидаемые ответы, например:
  - Можно использовать средства автотестирования Web вроде Selenium, делать запросы на создание вычисления и выполнения отчёта
  - Если есть API, то те же простые операции

#### Оценку работоспособности оборудования. 

- Диск 
  - общее состояние дисков, чтобы понимать когда нужно менять
    - состояние smart общее
    - изношенность дисков
    - состояние raid (цел/не цел/синхронизация)
  - нагрузку, поможет при анализе производительности нод и принятия решения по апгрейдам
    - IOPS
    - латентность
  - свободное место, чтобы нода не упала по банальной причине
    - объём свободного пространства
    - скорость заполнения пространства
- ЦП, общая загрузка и разбитая ещё на несколько метрик, чтобы видеть нет ли каких-то аномалий в системе, отъедающих ресурсы; понимать насколько конкретная нода загружена "коммерческой" работой, можно ли  добавить ещё или не стоит; видеть, нужно ли распределять систему, не мешают ли отчёты вычислениям
  - процент загрузки занятый системными запросами
  - процент загрузки занятый вычислениями
  - процент загрузки, занятый выполнением отчётов
- Объём и свободны объём ОЗУ
- Объём сетевого трафика по интерфейсам

#### Бизнес мониторинг.

Чтобы понимать специфику утилизации нод, чтобы правильно планировать бюджет на расширение и апгрейд и утилизацию в целом
- количество запущенных процессов на вычисления
- количество запущенных процессов на вычисления
- распределение, например "процент запущенных коммерческих вычислений, отъедающий 10% процессора, 50% и 90%"
- количество отчётов в работе
- количество запросов на отчёты за последние 5 минут
- количество выполненных отчётов за последние 5 минут

#### Мониторинг безопасности ИС.

Базовый аудит, который обычно настраивают для любой системы для разбора инцидентов - кто, что и когда делал, сколько было неудач
- Актуальность сертификатов
- Неудачные авторизации 
- Запросы отчётов
- Запросы запуска вычислений
- Специфику сетевого трафика, например географию запросов и количество "мелких" пакетов или невалидных пакетов, чтобы детектировать атаки

### Предложить менеджеру решение по метрикам

> 2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

Можно настроить мониторинг функциональности нашего продукта, чтобы понять, выполняем ли мы обязательства: выделить ключевые метрики SLI, сделать дешборды в Grafana, на которые вывести значения, насколько в динамике они соответствуют согласованным целям SLO. Так же сделать мониторинг, который покажет насколько продукт соответствует SLO за короткие периоды: последние 5/15/60 минут, сутки, двое  суток, неделю и тд.

### Что предпринять, чтобы разработчики получали ошибки приложения?

> 3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

* Если ресурсы жестко ограничены, можно написать скрипты для проверки логов на наличие ошибок. Если они есть, грепать ошибки и информировать разработчиков, например на какую-нибудь общую почту или группу рассылки.
* Если есть какая-то свобода и можно найти место для одной или двух виртуалок на существующих ресурсах, то можно развернуть Sentry и отправлять ошибки туда.

### Где ошибка в формуле мониторинга?

> 4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

Скорей всего проблема в том, что не учитываются 1хх и 3хх коды. Правильная формула должна быть такой:
```
(summ_2xx_requests + summ_1xx_requests + summ_3xx_requests)/summ_all_requests
```